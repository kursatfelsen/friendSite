{% extends "base.html" %}
{% load static %}
{% block body %}
<h1 class="text-center">Event Details<a href="{% url 'detail' event.group.id %}" class="text-decoration-none text-white"><button class="btn btn-danger ml-4">Turn back to group</a></span></h1>

<div class="row d-flex align-items-stretch">
    <div class="card border-primary mx-auto " style="width: 30rem;">
      <div class="card-header">
        {{event.name}}
      </div>
      <ul class="list-group list-group-flush">
        <li class="list-group-item"><b>Starting Time</b><span class="float-right">{{event.start_date}} - {{event.start_time}}</span></li>
        <li class="list-group-item"><b>Ending Time</b><span class="float-right">{{event.end_date}} - {{event.end_time}}</span></li>
        <li class="list-group-item"><b>State</b><span class="float-right">{{event.get_state_display}}</span></li>
        <li class="list-group-item"><b>Creator</b><span class="float-right">{{event.creator.user.username}}</span></li>
      </ul>
    </div>
  {% if event.state != "P1" %}
    <div id="event-attender">
    {% include "ajax_render/event_detail_planned.html" %}
    </div>
  {% else %}
  {% endif %}

</div>
<br>

<div class="row d-flex align-items-stretch">
  <div class="border-primary mx-auto " style="width: 30rem;">
{% if event.state == "P1" %}
    <div id="list-group-item-{{event.id}}">
        
        <p>Yeah: <input disabled id="{{event.id}}-1" value="{{ event.getYeas }}"><button class="btn btn-success float-right" vote-event="{% url 'vote' %}" onclick=vote({{user.id}},{{event.id}},1)>Vote Yeah</button></p>
        <p>Na: <input  disabled id="{{event.id}}-0" value="{{ event.getNas }}"><button class="btn btn-secondary float-right" vote-event="{% url 'vote' %}" onclick=vote({{user.id}},{{event.id}},0)>Vote No</button></p>
    </div>
    {% if event.creator.user.id == user.id and event.state == "P1" %}
        <button onclick=plan({{event.id}}) id="event-is-on-{{event.id}}" class="btn btn-warning"> Event is planned!</button>
    {% endif %}
    {% if event.creator.user.id == user.id %}
        <a href="{% url 'event_edit' event.id %}"><button class="btn btn-primary float-right">Edit</button></a>
        <a href="{% url 'event_delete' event.id %}"><button class="btn btn-danger float-right mr-1">Delete</button></a>
    {% endif %}
{% else %}
    <a href="{% url 'event_edit' event.id %}"><button class="btn btn-primary float-right ">Edit</button></a><span></span>
    <a href="{% url 'event_delete' event.id %}"><button class="btn btn-danger float-right mr-1">Delete</button></a>
{% endif %}
  </div>
</div>

<br>
{% if event.location %}
<h2 class="text-center">Location details</h2>
<div class="card mx-auto" style="width: 66rem;">
  <div class="row">
    <div class="col">
        <div class="card-body">
            <a href="{{event.location.website}}"><h5 class="card-title">{{event.location.name}}</h5></a>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">Phone: {{event.location.phone_number}}</li>
                <li class="list-group-item">Rating: {{event.location.rating}}</li>
                <li class="list-group-item">Type: {{event.location.type}}</li>
                <li class="list-group-item">{{event.location.address}}</li>
            </ul>
            <a href="#" class="btn btn-primary">Call</a>
        </div>
    </div>
    <div class="col">
    <div id="map" style="height: 400px; width: 100%;"></div>
    </div>
  </div>
  <img class="card-img-top" style="width: 66rem" src="{% if event.location.photo_url %}{{event.location.photo_url}}{% else %}https://pegasuseventsindia.files.wordpress.com/2014/04/eventmanagement-1.jpg?w=1400&h=400&crop=1{% endif %}" alt="Card image cap" >

</div>
{% else %}
<h2 class="text-center">There is no location is set for this event.</h2>
<button class="btn btn-success mx-auto">Set a location</button>
{% endif %}

{% endblock body %}


{% block extra_script %}

<script>
// Initialize and add the map
function initMap() {
  // The location of place
  const place = { lat: parseFloat({{event.location.latitude}}), lng: parseFloat({{event.location.longitude}}) };
  // The map, centered at place
  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 13,
    center: place,
  });
  // The marker, positioned at place
  const marker = new google.maps.Marker({
    position: place,
    map: map,
  });
}

</script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCgcemZoVjBawCcvVhySBtDyjDYxc2Bb9k&callback=initMap&libraries=&v=weekly" async></script>

<script>

function vote(u_id, e_id, status){
        $.ajax({
            url: {% url 'vote' %},
            type: "GET",
            data: {'user_id': u_id,'event_id':e_id,'status':status},
            success: function (data) {
                document.getElementById(e_id+'-0').value = data.nas;
                document.getElementById(e_id+'-1').value = data.yeas;
            }
        });
    }

function plan(e_id){
        $.ajax({
            url: {% url 'plan' %},
            type: "GET",
            data: {'event_id':e_id},
            success: function (data) {
                document.getElementById('event-is-on-'+e_id).remove();
                if (data.planned){
                    str = '<div id="list-group-item-'+e_id+'"><a href="/event/detail/'+e_id+'">'+data.event_name+'</a><span class="float-right" id="status-'+e_id+'">Status:Planned</span><h5>Attenders:</h5><div class="card"><ul class="list-group">';
                    for (var i=0;i<data.attenders.length;i++){
                        str += '<li class="list-group-item">'+ data.attenders[i] +'</li>';
                    }
                    str += '</ul></div><br></div>';
                    document.getElementById('list-group-item-'+e_id).outerHTML = str;
                }
            }
        });
    }
</script>
{% endblock extra_script %}
    


